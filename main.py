import re
import json
from bs4 import BeautifulSoup

populations = {"CA-44": 713249, "CA-45": 721016, "CA-46": 710948, "CA-47": 719805, "CA-40": 708460, "CA-41": 722665, "CA-42": 717412, "CA-43": 702983, "CA-48": 711992, "CA-49": 702141, "FL-1": 703033, "FL-3": 700008, "FL-2": 701463, "FL-5": 701732, "FL-4": 700499, "FL-7": 702203, "FL-6": 709868, "FL-9": 688665, "FL-8": 699857, "NY-12": 708096, "NY-13": 738943, "NY-10": 716172, "NY-11": 724434, "NY-16": 721008, "NY-17": 724191, "NY-14": 712053, "NY-15": 731101, "NY-18": 726712, "NY-19": 710597, "RI-1": 524097, "PA-8": 704485, "PA-9": 707435, "PA-6": 727295, "PA-7": 692866, "PA-4": 710196, "PA-5": 706147, "PA-2": 726364, "PA-3": 705049, "PA-1": 678723, "ND-0": 683932, "MI-14": 707582, "NJ-12": 732031, "NJ-11": 724761, "NJ-10": 726382, "TX-35": 724271, "TX-34": 702624, "TX-36": 712433, "TX-31": 721698, "TX-30": 694383, "TX-33": 710945, "TX-32": 711796, "HI-2": 684133, "HI-1": 690677, "WV-1": 614309, "WV-2": 626469, "WV-3": 614586, "VA-8": 742531, "VA-9": 725764, "VA-1": 743824, "VA-2": 710769, "VA-3": 744369, "VA-4": 736977, "VA-5": 726376, "VA-6": 734204, "VA-7": 733911, "WI-8": 718245, "WI-7": 713509, "WI-6": 709417, "WI-5": 713261, "WI-4": 715895, "WI-3": 710796, "WI-2": 720334, "WI-1": 710310, "KY-6": 733205, "WA-7": 683158, "WA-6": 674679, "WA-5": 676030, "WA-4": 690421, "WA-3": 680915, "WA-2": 678014, "WA-1": 686848, "WA-9": 693596, "WA-8": 681117, "TX-7": 726696, "TX-6": 722452, "TX-5": 719368, "TX-4": 704984, "TX-3": 728269, "TX-2": 721185, "TX-1": 703177, "TX-9": 691497, "TX-8": 720727, "TX-12": 710406, "IN-2": 717237, "IN-3": 722205, "IN-1": 722224, "IL-8": 724644, "IL-9": 715584, "IN-4": 729244, "IN-5": 731702, "IL-4": 737025, "IL-5": 712292, "IL-6": 712712, "IL-7": 703012, "IL-1": 711982, "IL-2": 718507, "IL-3": 713092, "OH-10": 725479, "OH-11": 705659, "OH-12": 727728, "OH-13": 723713, "OH-14": 716967, "OH-15": 719537, "OH-16": 724108, "ID-1": 791876, "ID-2": 793109, "IL-16": 713840, "IL-17": 711719, "IL-14": 718232, "IL-15": 715066, "IL-12": 713289, "IL-13": 712716, "IL-10": 705564, "IL-11": 722745, "WY-0": 568158, "PA-18": 711540, "CA-31": 727523, "CA-30": 726471, "CA-33": 707854, "CA-32": 693701, "CA-35": 710704, "CA-34": 698741, "CA-37": 719034, "CA-36": 713166, "CA-39": 711645, "CA-38": 714100, "NY-27": 713175, "NY-26": 719909, "NY-25": 717475, "NY-24": 713010, "NY-23": 717909, "NY-22": 720201, "NY-21": 717663, "NY-20": 720133, "PA-14": 703257, "PA-15": 723086, "PA-16": 702245, "PA-17": 694123, "PA-10": 712217, "PA-11": 705197, "PA-12": 703764, "PA-13": 728897, "IA-4": 761467, "IA-1": 763903, "IA-3": 770819, "IA-2": 766120, "AL-4": 682029, "AL-5": 691438, "GA-11": 689738, "GA-13": 718096, "GA-12": 704537, "AL-6": 687709, "AL-7": 690499, "AL-1": 689110, "AL-2": 678860, "GA-14": 694398, "SC-5": 662829, "SC-4": 671222, "SC-7": 667752, "SC-6": 667523, "SC-1": 667388, "SC-3": 666024, "SC-2": 676492, "AL-3": 683095, "TX-26": 722749, "TX-27": 701765, "TX-24": 719185, "TX-25": 714682, "TX-22": 720879, "TX-23": 725874, "TX-20": 716759, "TX-21": 723750, "TX-28": 710260, "TX-29": 718379, "VT-0": 626431, "SD-0": 824082, "AK-0": 722718, "NC-11": 730469, "TN-5": 713990, "TN-4": 708356, "TN-7": 714187, "TN-6": 713928, "TN-1": 707424, "TN-3": 715757, "TN-2": 712089, "TN-9": 710874, "TN-8": 706748, "NC-13": 732434, "IN-6": 720186, "IN-7": 726771, "UT-1": 699943, "UT-2": 705688, "UT-3": 708809, "UT-4": 702782, "KY-3": 726812, "KY-2": 733610, "KY-1": 720774, "IN-8": 720783, "KY-5": 723855, "KY-4": 731100, "IN-9": 726570, "AR-4": 736183, "AR-2": 739092, "AR-3": 733194, "AR-1": 729510, "NH-2": 657433, "RI-2": 527205, "LA-2": 767984, "LA-3": 760696, "LA-1": 759507, "LA-6": 763016, "LA-4": 758453, "LA-5": 765180, "MO-8": 747756, "MO-3": 762347, "MO-2": 752403, "MO-1": 739977, "MO-7": 751514, "MO-6": 753729, "MO-5": 747573, "MO-4": 755389, "CA-22": 711709, "CA-23": 707345, "CA-20": 712087, "CA-21": 714164, "CA-26": 708300, "CA-27": 709231, "CA-24": 708744, "CA-25": 714313, "MD-1": 722628, "CA-28": 706585, "CA-29": 687063, "MD-4": 736929, "MD-5": 726753, "MD-6": 731965, "MD-7": 713872, "AZ-6": 743752, "AZ-7": 725197, "AZ-4": 707750, "AZ-5": 711895, "AZ-2": 722918, "AZ-3": 707336, "AZ-1": 724868, "NC-10": 740773, "AZ-8": 715893, "AZ-9": 722896, "NJ-3": 732131, "NJ-2": 736397, "NJ-1": 727496, "NJ-7": 747216, "MA-7": 733814, "NJ-5": 731055, "NJ-4": 736007, "NJ-9": 742508, "NJ-8": 746415, "CA-9": 707132, "CA-8": 699443, "CA-3": 698044, "CA-2": 707530, "CA-1": 699301, "CA-7": 710607, "CA-6": 713579, "CA-5": 709544, "CA-4": 711815, "VA-10": 750886, "VA-11": 746993, "MN-8": 661995, "MI-11": 706645, "MI-10": 701831, "MI-13": 699214, "MI-12": 703389, "NM-1": 698441, "NM-2": 702936, "NM-3": 680847, "KS-4": 715456, "KS-1": 718350, "KS-3": 722973, "KS-2": 714459, "GA-10": 694613, "TX-13": 698612, "MD-8": 747185, "TX-11": 700744, "TX-10": 709456, "TX-17": 710793, "TX-16": 707375, "TX-15": 722529, "TX-14": 708198, "TX-19": 708642, "TX-18": 707139, "FL-20": 713165, "FL-21": 720995, "FL-22": 703505, "FL-23": 703594, "FL-24": 693086, "FL-25": 723113, "FL-26": 728285, "FL-27": 712083, "CA-53": 723699, "CA-52": 699398, "CA-51": 717894, "CA-50": 724472, "ME-1": 668146, "ME-2": 660042, "MD-2": 727061, "MD-3": 721896, "CO-1": 739671, "CO-3": 719526, "CO-2": 727317, "CO-5": 733850, "CO-4": 722690, "CO-7": 729216, "CO-6": 744526, "WA-10": 685260, "NH-1": 660761, "NE-1": 616728, "NE-2": 617475, "NE-3": 608438, "MA-9": 727771, "MA-8": 732884, "MS-4": 749289, "MS-3": 745254, "MS-2": 743249, "MS-1": 740720, "MA-1": 728921, "MA-3": 732090, "MA-2": 726061, "MA-5": 737545, "MA-4": 736769, "NC-12": 737200, "MA-6": 731681, "MN-6": 675415, "MN-7": 661532, "MN-4": 669310, "MN-5": 677196, "MN-2": 668891, "MN-3": 664419, "MN-1": 666103, "NV-4": 680935, "NV-3": 703278, "NV-2": 679147, "NV-1": 659962, "DE-0": 907135, "NY-8": 715905, "NY-9": 739328, "IL-18": 707238, "NY-1": 720071, "NY-2": 724053, "NY-3": 724164, "NY-4": 716038, "NY-5": 740327, "NY-6": 707630, "NY-7": 724899, "NC-6": 749909, "NC-7": 745559, "NC-4": 758619, "NC-5": 726638, "NC-2": 744671, "NC-3": 749823, "NC-1": 739665, "NC-8": 750059, "NC-9": 750582, "FL-19": 696776, "FL-18": 687695, "FL-11": 700956, "FL-10": 741792, "FL-13": 694899, "FL-12": 701580, "FL-15": 714155, "FL-14": 717231, "FL-17": 694509, "FL-16": 702795, "MI-1": 708797, "MI-3": 709467, "MI-2": 709073, "MI-5": 698753, "MI-4": 703259, "MI-7": 701436, "MI-6": 707375, "MI-9": 712540, "MI-8": 706826, "CT-2": 711006, "CT-3": 718549, "CT-1": 715378, "CT-4": 726619, "CT-5": 709157, "NJ-6": 738756, "OR-4": 770184, "OR-5": 772980, "OR-1": 775806, "OR-2": 770403, "OR-3": 782486, "MT-0": 998199, "CA-19": 695402, "CA-18": 717397, "CA-17": 724244, "CA-16": 714214, "CA-15": 708580, "CA-14": 726958, "CA-13": 712144, "CA-12": 700605, "CA-11": 722847, "CA-10": 713912, "OH-2": 716833, "OH-3": 732258, "OH-1": 729005, "OH-6": 717143, "OH-7": 726076, "OH-4": 721717, "OH-5": 714435, "OH-8": 726266, "OH-9": 718027, "GA-7": 687296, "GA-6": 699103, "GA-5": 708928, "GA-4": 720228, "GA-3": 687745, "GA-2": 699490, "GA-1": 703020, "GA-9": 714378, "GA-8": 693640, "OK-1": 764815, "OK-3": 745941, "OK-2": 753014, "OK-5": 762555, "OK-4": 765183}

lookup = [('Alabama', 'AL'),
       ('Alaska', 'AK'),
       ('Arizona', 'AZ'),
       ('Arkansas', 'AR'),
       ('California', 'CA'),
       ('Colorado', 'CO'),
       ('Connecticut', 'CT'),
       ('Delaware', 'DE'),
       ('District of Columbia', 'DC'),
       ('Florida', 'FL'),
       ('Georgia', 'GA'),
       ('Hawaii', 'HI'),
       ('Idaho', 'ID'),
       ('Illinois', 'IL'),
       ('Indiana', 'IN'),
       ('Iowa', 'IA'),
       ('Kansas', 'KS'),
       ('Kentucky', 'KY'),
       ('Louisiana', 'LA'),
       ('Maine', 'ME'),
       ('Maryland', 'MD'),
       ('Massachusetts', 'MA'),
       ('Michigan', 'MI'),
       ('Minnesota', 'MN'),
       ('Mississippi', 'MS'),
       ('Missouri', 'MO'),
       ('Montana', 'MT'),
       ('Nebraska', 'NE'),
       ('Nevada', 'NV'),
       ('New Hampshire', 'NH'),
       ('New Jersey', 'NJ'),
       ('New Mexico', 'NM'),
       ('New York', 'NY'),
       ('North Carolina', 'NC'),
       ('North Dakota', 'ND'),
       ('Ohio', 'OH'),
       ('Oklahoma', 'OK'),
       ('Oregon', 'OR'),
       ('Pennsylvania', 'PA'),
       ('Rhode Island', 'RI'),
       ('South Carolina', 'SC'),
       ('South Dakota', 'SD'),
       ('Tennessee', 'TN'),
       ('Texas', 'TX'),
       ('Utah', 'UT'),
       ('Vermont', 'VT'),
       ('Virginia', 'VA'),
       ('Washington', 'WA'),
       ('West Virginia', 'WV'),
       ('Wisconsin', 'WI'),
       ('Wyoming', 'WY')]

lookup = dict(lookup)

def parse_tables(content):
    soup = BeautifulSoup(content, 'lxml')
    print('bs parsed')
    table_classes = {"class": ["sortable", "wikitable"]}
    wikitables = soup.findAll("table", table_classes)

    M = {}
    for table in wikitables[:-1]:
        for tr in table.findAll('tr')[2:]:
            name = tr.find('th').find('a').string.encode('utf-8').replace('at-large', '').replace("\xc2\xa0", '')
            number = re.search('\d{1,3}',s)
            if number is None:
                number = 0;
            else:
                number = number.group(0)
            code = lookup[re.search('[^\d]+', name).group(0)] + '-' + number
            print code
            results = str(tr.findAll('td')[-1])
            rep = results[results.find('(Republican)') + 13:results.find('(Republican)') + 17]
            try:
                rep = float(rep)
            except ValueError:
                rep = 0.0
            dem = results[results.find('(Democratic)') + 13:results.find('(Democratic)') + 17]
            try:
                dem = float(dem)
            except ValueError:
                dem = 0.0
            ind = 100 - rep - dem;
            pop = populations[code]
            M[code] = {
                'D': int(dem / 100 * pop),
                'R': int(rep / 100 * pop),
                'I': int(ind / 100 * pop),
                'dis': code,
            }

    return M

if __name__ == '__main__':
    with open('wiki.html') as f, open('districts.json', 'w') as d:
        json.dump(parse_tables(f.read()), d)
